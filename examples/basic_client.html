<html>
    <head>
        <!-- 'cuz we love nice things -->
        <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/pure-min.css">
        <style type="text/css">
            .rlegend {
                text-align: right;
            }
            .console { list-style-type: none; margin: 0; padding: 0; }
            .console li { padding: 5px 10px; }
            .console li:nth-child(odd) { background: #eee; }
        </style>
        <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
        <script src="../js/jsbhandler.js"></script>
        <script type="text/javascript">
            //
            // Example Javascript client code of usage
            //
            
            // Retrieve Singleton handler
            var jsbhandler = jsb.handler();
            
            // Wait for jsbhandler to initialize
            $(jsbhandler).on("ready", function() {
                console.log("applet started");
                
                // Create a client
                var client1 = jsbhandler.registerClient("homeClient", "localhost", 10100);                
                // wait for connection
                $(client1).on("connected", function() {
                    // display connection state for fun
                    $("connectionState").innerHTML = "Connected";
                    
                    // just so we know display current connection's duration with refresh-interval of 950ms
                    var timeCheck = setInterval(function() {
                        $("connectionTime").innerHTML = client1.connectionTime() + " sec";
                    }, 950); // little less then a second - to be certain
                    
                    // Listen for disconnect event
                    $(client1).on("disconnected", function() {
                        // reset connection state flag
                        $("connectionState").innerHTML = "Disconnected";
                        // kill further time checks
                        clearInterval(timeCheck);
                    });
                    
                    // Listen for data event
                    $(client1).on("readData", function(event, data) {
                        // simply append data to repsonse list
                        $("console").append($('<li>').text("Sent: " + JSON.stringify(data)));
                    });
                });
                
                // fire up some action on the page
                $("connectfrm").submit(function() {
                    client1.connect();
                    return false; // prevent default submit
                });
                
                $("sendfrm").submit(function() {
                    var m = $("message").val();
                    client1.send(m);
                    $("console").append($('<li>').text("Received: " + m));
                    $("message").val('');
                    return false;
                });
            });
        </script>
    </head>
    <body>
        <h1>CMJavaSocketBridge Basic Example</h1>
        <div class="pure-g">
            <div class="pure-u-2-5">
                <form id="connectfrm" action="" class="pure-form pure-form-stacked">
                    <fieldset>
                        <legend><span id="connectionState">Disconnected</span><span id="connectionTime"></span></legend>
                        <label for="host">Type host:port and hit connect</label>
                        <input type="text" id="host">
                        <button class="pure-button pure-button-primary">Connect</button>
                    <fieldset>
                </form>
                <form id="sendfrm" action="" class="pure-form pure-form-stacked">
                    <fieldset>
                        <label for="message">Data to send:</label>
                        <textarea id="message" placeholder='{"test" : "json"}' cols="45" rows="5"></textarea>
                        <button class="pure-button">Send</button>
                    </fieldset>
                </form>
            </div>
            <div class="pure-u-3-5">
                <form action="" class="pure-form pure-form-stacked">
                <legend class="rlegend">Console</legend>
                
                </form>
                <ul id="console"></ul>
            </div>
        </div>
        <applet id="CMJavaSocketBridge" archive="../java/dist/CMJavaSocketBridge.jar" code=com.cmexc.socketbridge.CMJSocketBridge.class width="1" height="1" mayscript></applet>
    </body>
</html>